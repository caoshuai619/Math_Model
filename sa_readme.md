# Question
&emsp;我方有一个基地，经度和纬度为（ 70,40）。假设我方飞机的速度为 1000 公里/小时。我方派一架飞机从基地出发，侦察完敌方所有目标，再返回原来的基地。在敌方每一目标点的侦察时间不计，求该架飞机所花费的时间（假设我方飞机巡航时间可以充分长）。这是一个旅行商问题。我们依次给基地编号为 1，敌方目标依次编号为 2， 3，…，101，最后我方基地再重复编号为 102（这样便于程序中计算）。 距离矩阵 D=(d<sub>ij</sub>)<sub>102×102</sub> ，其中d<sub>ij</sub>表示表示i, j 两点的距离， i, j = 1,2,L,102 ，这里 D 为实对称矩阵。则问题是求一个从点 1 出发，走遍所有中间点，到达点 102 的一个最短路径。

&emsp;上面问题中给定的是地理坐标（经度和纬度），我们必须求两点间的实际距离。设
A, B 两点的地理坐标分别为 (x1, y1) ， (x2 , y2 ) ，过 A, B 两点的大圆的劣弧长即为两点的实际距离。以地心为坐标原点O ，以赤道平面为 XOY 平面，以 0 度经线圈所在的平
面为 XOZ 平面建立三维直角坐标系。则 A, B 两点的直角坐标分别为：

<center>A(Rcos x<sub>1</sub> cos y<sub>1</sub>, Rsin x<sub>1</sub> cos y<sub>1</sub>, Rsin y<sub>1</sub>)

B(Rcos x<sub>2</sub> cos y<sub>2</sub> , Rsin x<sub>2</sub> cos y<sub>2</sub> , Rsin y<sub>2</sub> )</center>

其中 R = 6370 为地球半径。

&emsp;A,B 两点的实际距离

$$
d = R \cdot arccos( \frac{\vec{OA} \cdot \vec{OB}}{|\vec{OA}| \cdot |\vec{OB}|})
$$
化简得

$$
d = R\cdot \arccos[\cos(x_{1}-x_{2})\cos{y_{1}}\cos{y_2}+\sin{y_{1}sin{y_{2}}}]
$$

求解的模拟退火算法描述如下：

1. 解空间

    解空间 S 可表为{1,2,L,101,102 }的所有固定起点和终点的循环排列集合，即
S = {(π 1,L,π 102 ) | π 1 = 1,(π 2 ,L,π 101)为{2,3,L,101}的循环排列,π 102 = 102}
其中每一个循环排列表示侦察 100 个目标的一个回路， π i = j 表示在第i −1次侦察目
标 j ，初始解可选为 (1,2,L,102) ，本文中我们先使用 Monte Carlo 方法求得一个较好
的初始解。

2. 目标函数

    此时的目标函数为侦察所有目标的路径长度或称代价函数。我们要求
    $$
    minf(\pi_1,\pi_2,...,\pi_{102})=\sum_{i=1}^{101}d_{\pi,\pi_{i+1}}
    $$
    而一次迭代由下列三步构成：
3. 新解的产生   
+ 2变换法
\
任选序号 u,v （ u < v ）交换u 与 v 之间的顺序，此时的新路径为：
$$
\pi_1...\pi_{u-1}\pi_v\pi_{v-1}...\pi_{u+1}\pi_u\pi_{v+1}...\pi_{102}
$$
+ 3变换法
任选序号 u,v 和 w ，将 u 和 v 之间的路径插到 w 之后，对应的新路径为（设u < v < w )
$$
       \pi_1...\pi_{u-1}\pi_{v+1}...\pi_w\pi_u...\pi_v\pi_{w+1}...\pi_{102}
$$

4. 代价函数差
   
   对于 2 变换法，路径差可表示为

   $$
   \Delta{f}=(d_{\pi_{u-1}\pi_{v}}+d_{\pi_{u}\pi_{v+1}})-(d_{\pi_{u-1}\pi_{u}}+d_{\pi_{v}\pi_{v+1}})
   $$
   
5. 接受准则    
$$P = \begin{cases} 
1&\Delta{f}<0\\
\exp(-\Delta{f}/T)&\Delta{f}\geqslant0
\end{cases}$$
如果 Δf < 0 ，则接受新的路径。否则，以概率 exp(−Δf /T ) 接受新的路径，即若exp(−Δf /T ) 大于 0 到 1 之间的随机数则接受。

6. 降温
利用选定的降温系数α 进行降温即： T ← αT ，得到新的温度，这里我们取
α = 0.999。

7. 结束条件
用选定的终止温度 e = 10−30 ，判断退火过程是否结束。若T < e ，算法结束，输出
当前状态。